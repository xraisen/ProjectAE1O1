<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VMC Strategic Offensive: Comprehensive Analysis vs Canteen Canada</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fafaf9; /* Stone-50 */
            color: #292524; /* Stone-800 */
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f5f5f4; 
        }
        ::-webkit-scrollbar-thumb {
            background: #d6d3d1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a29e; 
        }

        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }

        .transition-all-300 {
            transition: all 0.3s ease-in-out;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 300px;
            max-height: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        .nav-btn.active {
            background-color: #292524;
            color: #ffffff;
        }
        
        .ad-copy-preview {
            border: 2px solid #3b82f6;
            background-color: #eff6ff;
        }
        .ad-url {
            color: #16a34a;
            font-weight: 500;
        }
        .ad-headline {
            color: #1d4ed8;
            font-weight: 700;
        }

        .vmc-accent { background-color: #d97706; }
        .battle-line {
            border-left: 4px solid #d97706;
            padding-left: 1rem;
        }
    </style>

</head>
<body class="antialiased selection:bg-stone-200 selection:text-stone-900">

    <!-- Navigation / Header -->
    <header class="bg-white border-b border-stone-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold tracking-tight text-stone-900">VMC Strategic Offensive: Dislodging Canteen Canada</h1>
                <p class="text-xs text-stone-500 uppercase tracking-wide">Prepared by Jose Espinosa for Vending Machine Canada (Evan the Owner)</p>
            </div>
            <nav class="hidden md:flex space-x-1">
                <button onclick="scrollToSection('landscape')" class="px-3 py-2 text-sm font-medium text-stone-600 hover:text-stone-900 rounded-md transition-colors">Competitors</button>
                <button onclick="scrollToSection('weakness')" class="px-3 py-2 text-sm font-medium text-stone-600 hover:text-stone-900 rounded-md transition-colors">Weaknesses</button>
                <button onclick="scrollToSection('search')" class="px-3 py-2 text-sm font-medium text-stone-600 hover:text-stone-900 rounded-md transition-colors">Search Terms</button>
                <button onclick="scrollToSection('ppc')" class="px-3 py-2 text-sm font-medium text-stone-600 hover:text-stone-900 rounded-md transition-colors">PPC Strategy</button>
                <button onclick="scrollToSection('insights')" class="px-3 py-2 text-sm font-medium text-stone-600 hover:text-stone-900 rounded-md transition-colors">Insights</button>
            </nav>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-16">

        <!-- Introduction Section -->
        <section class="text-center max-w-3xl mx-auto space-y-4">
            <h2 class="text-3xl font-bold text-stone-800">Strategic Intelligence Dashboard: Analyzing and Countering Canteen Canada</h2>
            <p class="text-lg text-stone-600 leading-relaxed">
                This comprehensive report analyzes Canteen Canada's market positioning, decodes their search terms, and reverse-engineers their strategies. Based on the 2025 source analysis, we provide Vending Machine Canada (VMC) with aggressive counter-strategies to exploit weaknesses and dominate key segments.
            </p>
            <div class="flex flex-wrap justify-center gap-2 mt-4">
                <span class="bg-stone-100 text-stone-600 px-3 py-1 rounded-full text-sm font-medium">Competitor Analysis</span>
                <span class="bg-stone-100 text-stone-600 px-3 py-1 rounded-full text-sm font-medium">Search Term Strategy</span>
                <span class="bg-amber-100 text-amber-800 px-3 py-1 rounded-full text-sm font-medium">VMC Counter-Strategy</span>
                <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium">Exploiting Weaknesses</span>
            </div>
        </section>

        <!-- COMPETITOR LANDSCAPE SECTION -->
        <section id="landscape" class="scroll-mt-24">
            <div class="mb-6">
                <h3 class="text-2xl font-bold text-stone-800">1. Competitor Landscape: Canteen & Peers</h3>
                <p class="text-stone-600 mt-2">
                    Overview of national operators, regional specialists, and niche players in the Canadian vending market, with market share projections and strategic focuses.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left: Controls & Chart -->
                <div class="lg:col-span-1 space-y-6">
                    <div class="bg-white p-6 rounded-xl card-shadow border border-stone-100">
                        <h4 class="font-semibold text-stone-700 mb-6 uppercase text-sm">Market Breakdown</h4>
                        <div class="chart-container">
                            <canvas id="competitorChart"></canvas>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <button onclick="filterCompetitors('All')" class="comp-filter-btn w-full text-left px-4 py-3 rounded-lg bg-stone-800 text-white transition-all">All Types</button>
                        <button onclick="filterCompetitors('National Operator')" class="comp-filter-btn w-full text-left px-4 py-3 rounded-lg bg-white text-stone-600 border border-stone-200 hover:bg-stone-50 transition-all">National Operators</button>
                        <button onclick="filterCompetitors('Regional Specialist')" class="comp-filter-btn w-full text-left px-4 py-3 rounded-lg bg-white text-stone-600 border border-stone-200 hover:bg-stone-50 transition-all">Regional Specialists</button>
                        <button onclick="filterCompetitors('Niche/Healthy')" class="comp-filter-btn w-full text-left px-4 py-3 rounded-lg bg-white text-stone-600 border border-stone-200 hover:bg-stone-50 transition-all">Niche/Healthy</button>
                        <button onclick="filterCompetitors('Manufacturer')" class="comp-filter-btn w-full text-left px-4 py-3 rounded-lg bg-white text-stone-600 border border-stone-200 hover:bg-stone-50 transition-all">Manufacturers</button>
                        <button onclick="filterCompetitors('Distributor')" class="comp-filter-btn w-full text-left px-4 py-3 rounded-lg bg-white text-stone-600 border border-stone-200 hover:bg-stone-50 transition-all">Distributors</button>
                    </div>
                </div>

                <!-- Right: Competitor Cards Grid -->
                <div class="lg:col-span-2">
                    <div id="competitorGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4 h-[500px] overflow-y-auto pr-4">
                        <!-- Cards populated by JS -->
                    </div>
                </div>
            </div>
        </section>

        <!-- WEAKNESS BATTLE CARD SECTION -->
        <section id="weakness" class="scroll-mt-24">
            <h3 class="text-3xl font-bold mb-8 text-stone-800">2. Canteen Canada Weakness Battle Card</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-xl card-shadow border border-red-100">
                    <h4 class="font-bold text-red-600 mb-3 uppercase tracking-tighter">Weakness: Price Gouging</h4>
                    <p class="text-sm text-stone-600 mb-4 leading-relaxed">Consumers report spending $2.59 for a soda at Canteen kiosks vs $1.75 elsewhere. This "price gouging" sentiment is a major friction point.</p>
                    <div class="bg-red-50 p-3 rounded text-xs font-bold text-red-800 italic">VMC Counter: "Transparent, Fair-Market Pricing."</div>
                </div>
                <div class="bg-white p-6 rounded-xl card-shadow border border-red-100">
                    <h4 class="font-bold text-red-600 mb-3 uppercase tracking-tighter">Weakness: The Bottler Trap</h4>
                    <p class="text-sm text-stone-600 mb-4 leading-relaxed">Canteen's reliance on bottler-owned machines limits machine variety and restricts snacks to national brands only.</p>
                    <div class="bg-red-50 p-3 rounded text-xs font-bold text-red-800 italic">VMC Counter: "Ultimate Variety—Unrestricted Selection."</div>
                </div>
                <div class="bg-white p-6 rounded-xl card-shadow border border-red-100">
                    <h4 class="font-bold text-red-600 mb-3 uppercase tracking-tighter">Weakness: Small Account Friction</h4>
                    <p class="text-sm text-stone-600 mb-4 leading-relaxed">Locations often charge a "service fee" just to have Canteen. Small-to-mid accounts are neglected in favor of mega-contracts.</p>
                    <div class="bg-red-50 p-3 rounded text-xs font-bold text-red-800 italic">VMC Counter: "No-Fee Service for Local Businesses."</div>
                </div>
            </div>
        </section>

        <!-- SEARCH TERM ANALYSIS SECTION -->
        <section id="search" class="scroll-mt-24">
            <div class="mb-6">
                <h3 class="text-2xl font-bold text-stone-800">3. Canteen's Search Term Strategy (Reverse-Engineered)</h3>
                <p class="text-stone-600 mt-2">
                    Analysis of high-value search terms Canteen targets, categorized by intent, with VMC counter-strategies.
                </p>
            </div>

            <div class="bg-white rounded-xl card-shadow border border-stone-100 overflow-hidden">
                <!-- Tabs -->
                <div class="flex overflow-x-auto border-b border-stone-100 bg-stone-50">
                    <button onclick="loadSearchCategory('brand')" class="search-tab active px-8 py-5 text-sm font-bold text-stone-500 hover:text-stone-900 border-b-2 border-transparent focus:outline-none" data-cat="brand">Brand + Service Intent</button>
                    <button onclick="loadSearchCategory('commercial')" class="search-tab px-8 py-5 text-sm font-bold text-stone-500 hover:text-stone-900 border-b-2 border-transparent focus:outline-none" data-cat="commercial">Commercial / Purchase Intent</button>
                    <button onclick="loadSearchCategory('local')" class="search-tab px-8 py-5 text-sm font-bold text-stone-500 hover:text-stone-900 border-b-2 border-transparent focus:outline-none" data-cat="local">Location + Local SEO</button>
                    <button onclick="loadSearchCategory('tech')" class="search-tab px-8 py-5 text-sm font-bold text-stone-500 hover:text-stone-900 border-b-2 border-transparent focus:outline-none" data-cat="tech">Feature / Technology</button>
                    <button onclick="loadSearchCategory('related')" class="search-tab px-8 py-5 text-sm font-bold text-stone-500 hover:text-stone-900 border-b-2 border-transparent focus:outline-none" data-cat="related">Related Services</button>
                </div>

                <div class="p-6 grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                    <div>
                        <h4 id="searchCatTitle" class="text-2xl font-bold text-stone-800">Brand + Service Intent</h4>
                        <p id="searchCatDesc" class="text-stone-500 mt-2"></p>
                        <div id="searchTermList" class="mt-4 space-y-2"></div>
                    </div>
                    <div class="chart-container">
                        <canvas id="searchChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- PPC COUNTER-STRATEGY SECTION -->
        <section id="ppc" class="scroll-mt-24">
            <div class="mb-6">
                <h3 class="text-2xl font-bold text-stone-800">4. VMC's Aggressive PPC Counter-Strategy</h3>
                <p class="text-stone-600 mt-2">
                    Tailored PPC campaigns to attack Canteen's weaknesses, with AI-generated ad copy for high-conversion targeting.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <!-- Sidebar Controls -->
                <div class="md:col-span-1 space-y-3">
                    <button onclick="renderPPC('brand_attack')" class="ppc-btn w-full text-left px-5 py-4 rounded-xl text-sm font-bold bg-stone-900 text-white shadow-xl transition-all hover:scale-105" data-key="brand_attack">Competitor Brand Attack</button>
                    <button onclick="renderPPC('local_dominance')" class="ppc-btn w-full text-left px-5 py-4 rounded-xl text-sm font-bold bg-white text-stone-600 border border-stone-200 hover:bg-stone-50 transition-all" data-key="local_dominance">Local Service Dominance</button>
                    <button onclick="renderPPC('healthy_disruption')" class="ppc-btn w-full text-left px-5 py-4 rounded-xl text-sm font-bold bg-white text-stone-600 border border-stone-200 hover:bg-stone-50 transition-all" data-key="healthy_disruption">Healthy Niche Disruption</button>
                    <button onclick="renderPPC('quality_focus')" class="ppc-btn w-full text-left px-5 py-4 rounded-xl text-sm font-bold bg-white text-stone-600 border border-stone-200 hover:bg-stone-50 transition-all" data-key="quality_focus">Service Quality Focus</button>
                    <button onclick="renderPPC('mro_industrial')" class="ppc-btn w-full text-left px-5 py-4 rounded-xl text-sm font-bold bg-white text-stone-600 border border-stone-200 hover:bg-stone-50 transition-all" data-key="mro_industrial">Industrial MRO Edge</button>
                </div>

                <!-- Dynamic Content Area -->
                <div class="md:col-span-3">
                    <div id="ppcContent" class="bg-white rounded-2xl card-shadow p-8 border border-stone-100 h-full transition-all duration-300">
                        <!-- Content populated by JS -->
                    </div>
                </div>
            </div>
        </section>

        <!-- INSIGHTS & ROADMAP SECTION -->
        <section id="insights" class="scroll-mt-24 mb-12">
            <div class="bg-stone-800 rounded-2xl p-8 md:p-12 text-white">
                <div class="mb-8">
                    <h3 class="text-3xl font-bold mb-4">5. Strategic Insights & 2025 Roadmap</h3>
                    <p class="text-stone-300 leading-relaxed">
                        Key takeaways from the analysis, with actionable recommendations for VMC to capitalize on market opportunities and counter Canteen effectively.
                    </p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
                    <div class="bg-stone-700 p-6 rounded-xl">
                        <h4 class="text-xl font-bold text-amber-400 mb-3">Market Opportunities</h4>
                        <ul class="space-y-3 text-stone-200">
                            <li class="flex items-start gap-3">
                                <span class="text-amber-500 font-bold mt-1">▶</span>
                                <span><strong>Industrial Growth:</strong> MRO & PPE vending at 14.55% CAGR. Canteen slow to adapt.</span>
                            </li>
                            <li class="flex items-start gap-3">
                                <span class="text-amber-500 font-bold mt-1">▶</span>
                                <span><strong>Variety Gap:</strong> 65% expect café-quality coffee. Canteen's deals limit selection.</span>
                            </li>
                            <li class="flex items-start gap-3">
                                <span class="text-amber-500 font-bold mt-1">▶</span>
                                <span><strong>Response Speed:</strong> Regional rivals promise 20-minute response. VMC must out-service Canteen's lag.</span>
                            </li>
                        </ul>
                    </div>
                    <div class="bg-stone-700 p-6 rounded-xl">
                        <h4 class="text-xl font-bold text-amber-400 mb-3">Competitive Advantages</h4>
                        <ul class="space-y-3 text-stone-200">
                            <li class="flex items-start gap-3">
                                <span class="text-amber-500 font-bold mt-1">▶</span>
                                <span><strong>Local Ownership:</strong> Personalized service vs. national anonymity.</span>
                            </li>
                            <li class="flex items-start gap-3">
                                <span class="text-amber-500 font-bold mt-1">▶</span>
                                <span><strong>Freshness Focus:</strong> Curated, healthy selections with no restrictions.</span>
                            </li>
                            <li class="flex items-start gap-3">
                                <span class="text-amber-500 font-bold mt-1">▶</span>
                                <span><strong>Fast Service:</strong> 4-hour response times and transparent pricing.</span>
                            </li>
                        </ul>
                    </div>
                    <div class="bg-stone-700 p-6 rounded-xl">
                        <h4 class="text-xl font-bold text-amber-400 mb-3">Executive Summary</h4>
                        <div id="executiveSummaryResult" class="text-stone-400 italic text-sm">
                            Click below to generate AI-powered executive briefing.
                        </div>
                        <button onclick="generateExecutiveSummary()" class="mt-4 w-full py-3 bg-amber-600 text-white font-bold rounded-xl shadow-lg hover:bg-amber-700 transition-all">
                            Generate Executive Summary
                        </button>
                    </div>
                </div>

                <div class="relative">
                    <h4 class="text-2xl font-bold mb-6 text-amber-400">The Research Journey & Roadmap</h4>
                    <div class="space-y-8 relative before:absolute before:left-2 before:top-2 before:bottom-2 before:w-0.5 before:bg-amber-600/30">
                        <div class="pl-8 relative">
                            <div class="absolute left-0 top-1 w-4 h-4 rounded-full bg-amber-600"></div>
                            <h5 class="font-bold text-amber-500 uppercase text-xs tracking-widest mb-1">Step 1: Macro-Economic Analysis</h5>
                            <p class="text-stone-400 text-sm">Analyzed North American vending market (reaching $104B by 2033) and discovered Canada as fastest-growing territory, with Industrial Vending leading at 14.55% CAGR.</p>
                        </div>
                        <div class="pl-8 relative">
                            <div class="absolute left-0 top-1 w-4 h-4 rounded-full bg-amber-600"></div>
                            <h5 class="font-bold text-amber-500 uppercase text-xs tracking-widest mb-1">Step 2: Competitive Forensics</h5>
                            <p class="text-stone-400 text-sm">Deep-dived into Canteen and Aramark's financials and complaints. Identified "Bottler Trap" and "Price Gouging" as primary attack vectors.</p>
                        </div>
                        <div class="pl-8 relative">
                            <div class="absolute left-0 top-1 w-4 h-4 rounded-full bg-amber-600"></div>
                            <h5 class="font-bold text-amber-500 uppercase text-xs tracking-widest mb-1">Step 3: Strategic Conclusion</h5>
                            <p class="text-stone-400 text-sm">Three-pillar strategy: Attack on Variety, Attack on Pricing Transparency, and Aggressive Pivot to MRO/Industrial Vending.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- FOOTER -->
    <footer class="bg-stone-900 text-stone-400 py-8 border-t border-stone-800">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-sm">Prepared by Jose Espinosa for Vending Machine Canada (<a href="https://vendingcanada.ca/" class="text-amber-500 hover:text-amber-400">vendingcanada.ca</a>). &copy; 2025 Strategic Counter-Strategy Report.</p>
        </div>
    </footer>

    <!-- LOGIC SCRIPT -->
    <script>
        // --- DATA STORAGE & CONFIGURATION ---

        const apiKey = "AIzaSyCj4NKq2C_kXLfH27vfq_l_Iu8XMtlaXkc"; // Note: Replace with your actual API key for production
        const modelName = "gemini-2.5-flash-preview-09-2025";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;

        const competitorData = [
            { name: "Canteen Canada", type: "National Operator", strength: "Full-service, Tech-enabled, National", notes: "Market Leader Baseline" },
            { name: "Aramark Refreshment", type: "National Operator", strength: "Corporate clients, Catering", notes: "Strong enterprise contracts" },
            { name: "BetterVending", type: "Niche/Healthy", strength: "Organic focus, Ontario-based", notes: "Healthy Niche Leader" },
            { name: "Healthy Max", type: "Niche/Healthy", strength: "Nutritional snacks, Combo machines", notes: "Toronto-centric" },
            { name: "Fresh Healthy Vending", type: "Niche/Healthy", strength: "Smart machines, Healthy options", notes: "Local focus" },
            { name: "Selecta Canada", type: "National Operator", strength: "Legacy brand, Regional presence", notes: "Snack & Beverage vending" },
            { name: "Fraser Valley Vending", type: "Regional", strength: "Snack/Drink/Frozen", notes: "Vancouver area" },
            { name: "Vend Pro", type: "Regional", strength: "Workplace vending", notes: "Ottawa B2B focus" },
            { name: "Kane's Distributing", type: "Distributor", strength: "Refurbished & New machines", notes: "Nationwide" },
            { name: "QM Distribution", type: "Distributor", strength: "Smart machines, AI monitoring", notes: "Nationwide coverage" },
            { name: "Royal Vendors", type: "Manufacturer", strength: "Beverage vending machines", notes: "Via distributors" },
            { name: "AMS", type: "Manufacturer", strength: "Snack/drink combo machines", notes: "Widely distributed" },
            { name: "Seaga Manufacturing", type: "Manufacturer", strength: "Reliable machines", notes: "Nationwide distributor" },
            { name: "Adaria Vending", type: "Regional Specialist", strength: "Adaria Dashboard™, Advanced Telemetry", notes: "National tech leader" },
            { name: "Daily Blends", type: "Regional Specialist", strength: "AI demand forecasting, Fresh meals", notes: "Toronto/GTA focus" },
            { name: "Deli-Snack Vending", type: "Regional Specialist", strength: "20-minute response time", notes: "Montreal/Quebec" },
            { name: "Convenient Capybara", type: "Regional Specialist", strength: "VIVE healthy vending", notes: "Edmonton/Alberta" }
        ];

        const searchData = {
            brand: {
                title: "Brand + Service Intent",
                desc: "Direct navigation queries indicating high brand familiarity.",
                color: 'rgba(217, 119, 6, 0.8)',
                items: [
                    { term: "Canteen Canada", score: 95 },
                    { term: "Canteen vending services", score: 88 },
                    { term: "Canteen micro-markets", score: 82 },
                    { term: "Canteen office coffee", score: 78 },
                    { term: "Canteen SmartService", score: 75 }
                ]
            },
            commercial: {
                title: "Commercial / Purchase Intent",
                desc: "High-conversion queries from decision makers looking for suppliers.",
                color: 'rgba(41, 37, 36, 0.8)',
                items: [
                    { term: "vending machine services Canada", score: 98 },
                    { term: "commercial vending provider", score: 92 },
                    { term: "office vending solutions", score: 85 },
                    { term: "vending machine supplier", score: 80 },
                    { term: "bulk vending purchase", score: 75 }
                ]
            },
            local: {
                title: "Location + Local SEO",
                desc: "Geo-specific queries. Critical for capturing regional market share.",
                color: 'rgba(87, 83, 78, 0.8)',
                items: [
                    { term: "vending machine Toronto", score: 95 },
                    { term: "office vending Ottawa", score: 90 },
                    { term: "vending services Montreal", score: 88 },
                    { term: "local vending machine service", score: 82 },
                    { term: "vending machines near me", score: 78 }
                ]
            },
            tech: {
                title: "Feature / Technology",
                desc: "Innovation-focused queries targeting modern solutions.",
                color: 'rgba(120, 113, 108, 0.8)',
                items: [
                    { term: "smart vending machines", score: 90 },
                    { term: "IoT vending solutions", score: 85 },
                    { term: "AI powered vending", score: 80 },
                    { term: "cashless vending payment", score: 75 },
                    { term: "connected retail hubs", score: 70 }
                ]
            },
            related: {
                title: "Related Services",
                desc: "Cross-sell opportunities for broader breakroom needs.",
                color: 'rgba(168, 162, 158, 0.8)',
                items: [
                    { term: "office coffee service", score: 88 },
                    { term: "breakroom supplies", score: 82 },
                    { term: "corporate catering", score: 78 },
                    { term: "facility management", score: 75 },
                    { term: "employee wellness programs", score: 70 }
                ]
            }
        };

        // PPC Strategies for VMC (Counter-Strategy)
        const ppcStrategies = {
            brand_attack: {
                title: "Competitor Brand Attack (Canteen)",
                group: "Canteen Branded Terms",
                keywords: ["Canteen Canada", "Canteen vending services", "Canteen micro-markets"],
                desc: "Goal: Steal high-intent traffic directly from Canteen searchers. Strategy: Highlight VMC's local, personalized service vs. Canteen's national, hands-off approach."
            },
            local_dominance: {
                title: "Local Service Dominance Campaign",
                group: "Geo-Targeted Services",
                keywords: ["vending machine services Toronto", "local office vending provider", "vending machines near me"],
                desc: "Goal: Dominate local search results. Strategy: Use geo-modifiers to assure users VMC offers faster service and local support that national chains cannot match."
            },
            healthy_disruption: {
                title: "Healthy Niche Disruption Campaign",
                group: "High-Quality Healthy Vending",
                keywords: ["best healthy vending Canada", "gourmet office snacks vending", "organic vending services"],
                desc: "Goal: Capture the high-value 'wellness' segment. Strategy: Position VMC as the premium, health-focused alternative, emphasizing fresh, curated selections."
            },
            quality_focus: {
                title: "Service Quality & Maintenance Focus",
                group: "Reliability & Service",
                keywords: ["reliable vending machine service", "vending machine repair response", "24/7 vending refill service"],
                desc: "Goal: Address pain points with national operators. Strategy: Directly tackle common complaints (slow refills, broken machines) by promoting VMC's quick response times and new equipment."
            },
            mro_industrial: {
                title: "Industrial MRO Edge Campaign",
                group: "Warehouse/Factory Vending",
                keywords: ["PPE vending machine", "Factory snack service", "Industrial tool vending"],
                desc: "Goal: Target high-growth manufacturing sectors. Strategy: Highlight 40% waste reduction claims and specialized industrial solutions."
            }
        };

        // --- GLOBAL CHART VARIABLES & STATE ---
        let compChartInstance = null;
        let searchChartInstance = null;
        let currentPPCStrategy = 'brand_attack'; 

        // --- HELPER FUNCTIONS ---

        function showLoading(elementId) {
            const container = document.getElementById(elementId);
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center p-8 text-stone-500">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-stone-500"></div>
                    <p class="mt-4 text-sm">Generating content...</p>
                </div>
            `;
        }
        
        function showLoadingSummary(elementId) {
            const container = document.getElementById(elementId);
            container.classList.remove('text-stone-200', 'italic', 'text-sm');
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center p-4 text-stone-300">
                    <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-stone-300"></div>
                    <p class="mt-2 text-xs">Analyzing strategy...</p>
                </div>
            `;
        }

        async function fetchWithExponentialBackoff(fetcher, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    return await fetcher();
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }
        
        // --- GEMINI INTEGRATION 1: AD COPY GENERATOR ---

        async function generateAdCopy() {
            if (!apiKey) {
                const adCopyContainer = document.getElementById('adCopyResult');
                adCopyContainer.innerHTML = `
                    <div class="text-red-500 text-sm p-4">
                        API Key not configured. Please set the apiKey variable in the script.
                    </div>
                `;
                return; 
            }

            const strategyKey = currentPPCStrategy;
            const strategy = ppcStrategies[strategyKey];
            const adCopyContainer = document.getElementById('adCopyResult');

            showLoading('adCopyResult');

            const systemPrompt = "You are a hyper-aggressive, B2B digital marketing copywriter for Vending Machine Canada (VMC). Your tone must be highly competitive, directly comparing VMC's local expertise and superior service against national chains. You MUST format your response with a clear 'Headline 1:', 'Headline 2:', and 'Description 1:' label on separate lines. Keep the headlines concise (max 30 chars) and the description focused (max 90 chars).";
            const userQuery = `Generate compelling Google Ads copy for Vending Machine Canada based on the following VMC ad group strategy: "${strategy.desc}" The target keywords are: ${strategy.keywords.join(', ')}. Focus on: Local Ownership, Faster Service, and Better Snack Selection.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetchWithExponentialBackoff(() => fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                }));
                
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Error: Could not generate content.";
                
                displayAdCopy(text);

            } catch (error) {
                console.error("Gemini API call failed:", error);
                adCopyContainer.innerHTML = `
                    <div class="text-red-500 text-sm p-4">
                        API Error: ${error.message}. Check console for details.
                    </div>
                `;
            }
        }

        function displayAdCopy(text) {
            const adCopyContainer = document.getElementById('adCopyResult');
            const lines = text.split('\n').filter(line => line.trim() !== '');
            
            let headline1 = "N/A";
            let headline2 = "N/A";
            let description = "N/A";

            lines.forEach(line => {
                if (line.startsWith('Headline 1:')) {
                    headline1 = line.substring('Headline 1:'.length).trim();
                } else if (line.startsWith('Headline 2:')) {
                    headline2 = line.substring('Headline 2:'.length).trim();
                } else if (line.startsWith('Description 1:')) {
                    description = line.substring('Description 1:'.length).trim();
                }
            });

            adCopyContainer.innerHTML = `
                <div class="space-y-4">
                    <div class="ad-copy-preview p-4 rounded-xl">
                        <div class="ad-url text-xs mb-2">vendingcanada.ca</div>
                        <div class="ad-headline text-lg mb-1">${headline1}</div>
                        <div class="ad-headline text-lg mb-2">${headline2}</div>
                        <div class="text-stone-700 text-sm">${description}</div>
                    </div>
                    <p class="text-xs text-stone-500 italic">Generated ad copy preview for ${ppcStrategies[currentPPCStrategy].group}</p>
                </div>
            `;
        }

        // --- GEMINI INTEGRATION 2: EXECUTIVE SUMMARY GENERATOR ---

        async function generateExecutiveSummary() {
            if (!apiKey) {
                document.getElementById('executiveSummaryResult').innerHTML = `
                    <div class="text-red-500 text-xs p-2">
                        API Key not configured.
                    </div>
                `;
                return;
            }

            const container = document.getElementById('executiveSummaryResult');
            showLoadingSummary('executiveSummaryResult'); 

            const systemPrompt = "You are a Chief Strategy Officer writing a confident, single-paragraph executive summary for the company owner, Evan. The summary must be highly actionable, combining all strategies into one powerful final recommendation. The tone must be professional, brief, and decisive.";
            
            const userQuery = `Based on the competitor analysis of Canteen Canada and the recommended VMC counter-strategy (Brand Attack, Local Dominance, Healthy Niche Disruption, Quality Focus, Industrial MRO), synthesize a final, high-level, single-paragraph executive briefing for the owner. The summary must conclude by identifying VMC's single greatest competitive advantage to focus on in PPC and service.`;
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetchWithExponentialBackoff(() => fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                }));
                
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Error: Could not generate content.";
                
                displayExecutiveSummary(text);

            } catch (error) {
                console.error("Gemini API call failed for summary:", error);
                container.innerHTML = `
                    <div class="text-red-500 text-xs p-2">
                        API Error: ${error.message}.
                    </div>
                `;
            }
        }

        function displayExecutiveSummary(summaryText) {
            const container = document.getElementById('executiveSummaryResult');
            container.classList.remove('italic', 'text-sm', 'text-stone-400');
            container.innerHTML = `<p class="text-lg font-medium text-stone-50 leading-relaxed">${summaryText}</p>`;
        }

        // --- CORE FUNCTIONS ---

        function initCompetitorChart() {
            const ctx = document.getElementById('competitorChart').getContext('2d');
            
            const typeCounts = {};
            competitorData.forEach(c => {
                let type = c.type;
                typeCounts[type] = (typeCounts[type] || 0) + 1;
            });

            const labels = Object.keys(typeCounts);
            const data = Object.values(typeCounts);

            compChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: ['#d97706', '#78716c', '#a8a29e', '#d6d3d1', '#f5f5f4', '#92400e'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 12,
                                font: { size: 11 }
                            }
                        }
                    }
                }
            });
        }

        function filterCompetitors(type) {
            document.querySelectorAll('.comp-filter-btn').forEach(btn => {
                if (btn.textContent.includes(type) || (type === 'All' && btn.textContent === 'All Types')) {
                    btn.classList.add('bg-stone-800', 'text-white');
                    btn.classList.remove('bg-white', 'text-stone-600', 'border', 'border-stone-200');
                } else {
                    btn.classList.remove('bg-stone-800', 'text-white');
                    btn.classList.add('bg-white', 'text-stone-600', 'border', 'border-stone-200');
                }
            });

            const grid = document.getElementById('competitorGrid');
            grid.innerHTML = '';

            const filtered = type === 'All' 
                ? competitorData 
                : competitorData.filter(c => c.type === type);

            filtered.forEach(c => {
                const card = document.createElement('div');
                card.className = "bg-white p-5 rounded-lg border border-stone-200 hover:border-amber-500 transition-colors shadow-sm";
                card.innerHTML = `
                    <h5 class="font-bold text-stone-900 mb-1">${c.name}</h5>
                    <p class="text-xs font-bold text-amber-600 mb-2">${c.type}</p>
                    <p class="text-xs text-stone-600 italic leading-relaxed">${c.strength}</p>
                    <p class="text-xs text-stone-500 italic mt-1">"${c.notes}"</p>
                `;
                grid.appendChild(card);
            });
        }

        function initSearchChart() {
            const ctx = document.getElementById('searchChart').getContext('2d');
            searchChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: 'rgba(217, 119, 6, 0.8)',
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { 
                            grid: { display: false },
                            ticks: { font: { size: 11 } }
                        }
                    }
                }
            });
        }

        function loadSearchCategory(catKey) {
            document.querySelectorAll('.search-tab').forEach(t => {
                t.classList.remove('border-amber-600', 'text-stone-900');
                if(t.dataset.cat === catKey) t.classList.add('border-amber-600', 'text-stone-900');
            });

            const data = searchData[catKey];
            
            document.getElementById('searchCatTitle').innerText = data.title;
            document.getElementById('searchCatDesc').innerText = data.desc;

            const list = document.getElementById('searchTermList');
            list.innerHTML = '';
            data.items.forEach(item => {
                const li = document.createElement('li');
                li.className = "flex justify-between items-center text-sm p-2 hover:bg-white rounded transition-colors";
                li.innerHTML = `
                    <span class="text-stone-700 font-medium">"${item.term}"</span>
                    <span class="text-amber-600 font-bold">${item.score}%</span>
                `;
                list.appendChild(li);
            });

            if (searchChartInstance) {
                searchChartInstance.data.labels = data.items.map(i => i.term.length > 20 ? i.term.substring(0,20)+'...' : i.term);
                searchChartInstance.data.datasets[0].data = data.items.map(i => i.score);
                searchChartInstance.data.datasets[0].backgroundColor = data.color;
                searchChartInstance.update();
            }
        }

        function renderPPC(strategyKey) {
            currentPPCStrategy = strategyKey;
            document.querySelectorAll('.ppc-btn').forEach(btn => {
                btn.classList.remove('bg-stone-900', 'text-white', 'shadow-xl', 'scale-105');
                btn.classList.add('bg-white', 'text-stone-600');
                if(btn.dataset.key === strategyKey) btn.classList.add('bg-stone-900', 'text-white', 'shadow-xl', 'scale-105');
            });

            const s = ppcStrategies[strategyKey];
            const container = document.getElementById('ppcContent');
            
            container.style.opacity = '0';
            
            setTimeout(() => {
                container.innerHTML = `
                    <div class='mb-6'>
                        <span class='text-xs font-bold text-amber-600 uppercase tracking-widest'>Attack Vector</span>
                        <h4 class='text-2xl font-bold text-stone-900 mt-1'>${s.title}</h4>
                        <p class='text-stone-500 mt-2 text-sm italic'>${s.desc}</p>
                    </div>
                    <div class='bg-stone-50 p-6 rounded-xl border border-stone-200'>
                        <h5 class='text-xs font-bold text-stone-400 uppercase mb-3'>High-Intent Keywords</h5>
                        <div class='flex flex-wrap gap-2 mb-6'>
                            ${s.keywords.map(k => `<span class='bg-amber-100 text-amber-800 px-3 py-1 rounded-full text-xs font-medium'>${k}</span>`).join('')}
                        </div>
                        <button onclick='generateAdCopy()' class='w-full py-4 bg-amber-600 text-white font-bold rounded-xl shadow-lg hover:bg-amber-700 transition-all'>
                            Generate Ad Copy
                        </button>
                    </div>
                    <div id='adCopyResult' class='mt-6 min-h-[150px] flex items-center justify-center border-2 border-dashed border-stone-200 rounded-xl'>
                        <p class='text-stone-400 text-sm'>Click "Generate Ad Copy" to create AI-powered ads</p>
                    </div>
                `;
                container.style.opacity = '1';
            }, 300);
        }

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // --- INITIALIZATION ---
        window.addEventListener('DOMContentLoaded', () => {
            initCompetitorChart();
            filterCompetitors('All'); 
            
            initSearchChart();
            loadSearchCategory('brand'); 

            renderPPC('brand_attack'); 
        });

    </script>
</body>
</html>
